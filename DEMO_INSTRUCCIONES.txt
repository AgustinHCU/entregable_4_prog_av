Demo — Presentación en clase: Music Playlist (Entregable 4)

1) Ejecutar la aplicación localmente (2 min)
- Compilar/paquetear:
  mvn package
- Ejecutar JAR:
  cd target
  java -jar music-playlist-0.0.1-SNAPSHOT.jar
- Abrir en el navegador: http://localhost:8081

2) Demo funcional (3-4 min)
- Videos de ejemplo:


3) code smell
  1. Crear rama para el refactor:
    - git checkout -b fix/refactor-process-action
  2. Modificar `PlaylistController.java` según el refactor (extraer métodos y eliminar duplicación).
  3. Ejecutar tests localmente y confirmar que pasan:
    - `mvn test`
  4. Commits y push a remoto:
    - git add src/main/java/com/agustin/music_playlist/controller/PlaylistController.java
    - git commit -m "Refactor: extract handlers for like/favorite, remove duplication"
    - git push origin fix/refactor-process-action
  5. En Jenkins: si el pipeline está configurado para detectar cambios, el push iniciará automáticamente el pipeline:
 
Código listo para copiar/pegar (reemplazo de `processAction`)

/* --- Código a pegar (Reemplazo de processAction) --- */
private String handleLike(Long id, Model model) {
  if (id == null || id <= 0) {
    model.addAttribute("error", "Invalid id for like");
    model.addAttribute("videos", playlistService.getAllVideos());
    return "playlist";
  }
  playlistService.likeVideo(id);
  model.addAttribute("message", "Liked video " + id);
  model.addAttribute("videos", playlistService.getAllVideos());
  return "playlist";
}

private String handleFavorite(Long id, Model model) {
  if (id == null || id <= 0) {
    model.addAttribute("error", "Invalid id for favorite");
    model.addAttribute("videos", playlistService.getAllVideos());
    return "playlist";
  }
  playlistService.toggleFavorite(id);
  model.addAttribute("message", "Toggled favorite " + id);
  model.addAttribute("videos", playlistService.getAllVideos());
  return "playlist";
}

public String processAction(String action, Long id, Model model) {
  if (action == null || action.isEmpty()) {
    model.addAttribute("error", "No action provided");
    model.addAttribute("videos", playlistService.getAllVideos());
    return "playlist";
  }

  switch (action) {
    case "like":
      return handleLike(id, model);
    case "favorite":
      return handleFavorite(id, model);
    default:
      model.addAttribute("error", "Unknown action");
      model.addAttribute("videos", playlistService.getAllVideos());
      return "playlist";
  }
}
/* --- Fin del código a pegar --- */

// ----- CODE SMELL INTENCIONAL (para la demo) -----
    // Este método contiene lógica duplicada y mezcla responsabilidades:
    // valida parámetros, modifica el modelo y realiza acciones sobre el servicio.
    // Es intencionalmente verboso e innecesariamente complejo para mostrar
    // un "code smell" que se corregirá durante la demo mediante refactor.
    public String processAction(String action, Long id, Model model) {
        // Validación pobre (duplicada en varios lugares)
        if (action == null || action.isEmpty()) {
            model.addAttribute("error", "No action provided");
            return "playlist";
        }

        // Lógica duplicada: manejo de 'like' y 'favorite' con código similar
        if (action.equals("like")) {
            // comprobar id
            if (id == null || id <= 0) {
                model.addAttribute("error", "Invalid id for like");
                return "playlist";
            }
            // realizar la acción
            playlistService.likeVideo(id);
            // actualizar modelo
            model.addAttribute("message", "Liked video " + id);
            List<Video> videos = playlistService.getAllVideos();
            model.addAttribute("videos", videos);
            return "playlist";
        }

        if (action.equals("favorite")) {
            if (id == null || id <= 0) {
                model.addAttribute("error", "Invalid id for favorite");
                return "playlist";
            }
            playlistService.toggleFavorite(id);
            model.addAttribute("message", "Toggled favorite " + id);
            List<Video> videos = playlistService.getAllVideos();
            model.addAttribute("videos", videos);
            return "playlist";
        }

        model.addAttribute("error", "Unknown action");
        return "playlist";
    }

